<!DOCTYPE html>
<html>
<head>
  <title>Test Backend</title>
</head>
<body>
  <img id="imgViewer"/>
  <button id="positive-btn">Positive</button>
  <button id="negative-btn">Negative</button>

  <script>
    const imgViewer = document.getElementById('imgViewer');
    const positiveBtn = document.getElementById('positive-btn');
    const negativeBtn = document.getElementById('negative-btn');
    let imageIndex = -1; // replace with the actual image index
    getNextImg();

    // Add a positive annotation for the current image
    positiveBtn.addEventListener('click', () => {
      addAnnotation(true);
      getNextImg();
    });

    // Add a negative annotation for the current image
    negativeBtn.addEventListener('click', () => {
      addAnnotation(false);
      getNextImg();
    });

    // Get the next image to annotate
    function getNextImg() {
      fetch('http://0.0.0.0:8000/get_next_img')
        .then(response => {
          imageIndex = response.headers.get('image_index');
          return response.blob().then(blob => ({ blob, imageIndex }));
        })
        .then(({blob, imageIndex}) => {
          const url = URL.createObjectURL(blob);
          imgViewer.src = url;
          console.log('Image index:', imageIndex);
        });
    }

  function addAnnotation(isPositive) {
    fetch('http://0.0.0.0:8000/add_annotation', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        image_index: imageIndex,
        is_positive: isPositive
      })
    })
      .then(response => {
        console.log('Response status:', response.status);
        return response.json();
      })
      .then(data => console.log('Response body:', data))
      .catch(error => console.error('Error:', error));
  }
  </script>
</body>
</html>